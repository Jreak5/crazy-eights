<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Crazy 8's</title>
<style>
:root{--gap:10px;--card-pad:10px;--btn-pad:12px 16px;--radius:10px;--shadow:0 2px 8px rgba(0,0,0,.15);}
*{box-sizing:border-box;}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;padding:16px;background:#f6f7fb;color:#111;}
h1{font-size:1.4rem;margin:0 0 8px;}
.row{display:flex;gap:var(--gap);flex-wrap:wrap;align-items:center;}
.board{display:flex;flex-direction:column;gap:var(--gap);max-width:900px;margin:0 auto;}
.panel{background:#fff;border-radius:var(--radius);padding:12px;box-shadow:var(--shadow);}
.topline{display:flex;align-items:center;justify-content:space-between;gap:12px;}
.badges{display:flex;gap:8px;flex-wrap:wrap;}
.badge{background:#eef;border-radius:999px;padding:6px 10px;font-size:.9rem;}
.controls{display:flex;gap:8px;flex-wrap:wrap;}
button{padding:var(--btn-pad);border-radius:12px;border:0;background:#111;color:#fff;font-weight:600;box-shadow:var(--shadow);touch-action:manipulation;font-size:1rem;}
button.secondary{background:#e5e7eb;color:#111;}
button:disabled{opacity:.55;}
.card{display:inline-flex;align-items:center;justify-content:center;padding:var(--card-pad);min-width:52px;height:72px;border-radius:8px;border:2px solid #ddd;background:#fff;font-weight:700;box-shadow:var(--shadow);margin:4px;user-select:none;}
.card.red{color:#c0262d;}
.card.black{color:#111;}
.card.small{min-width:44px;height:60px;font-size:.95rem;}
.hand{display:flex;flex-wrap:wrap;}
.hand button{background:transparent;border:none;padding:0;margin:0;}
.subtle{color:#555;font-size:.95rem;}
.discard{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
.pile{display:flex;align-items:center;gap:8px;}
.wide{width:100%;}
.log{max-height:160px;overflow:auto;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:.95rem;background:#0b1020;color:#e6edf3;border-radius:10px;padding:10px;}
.log b{color:#ffcf55;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px;z-index:10;}
.modal .sheet{background:#fff;border-radius:16px;max-width:420px;width:100%;padding:18px;box-shadow:var(--shadow);text-align:center;}
.suit-grid{display:grid;grid-template-columns:repeat(2,minmax(80px,1fr));gap:12px;margin-top:10px;}
/* keep font fallback for accessibility, but icons are SVG so they will always show */
.suit-btn{padding:10px;border-radius:12px;border:2px solid #ddd;background:#fff;box-shadow:var(--shadow); font-family: "Segoe UI Symbol", "Arial Unicode MS", sans-serif; display:flex;align-items:center;justify-content:center;}
.suit-btn svg{width:42px;height:42px;display:block;margin:0 auto;}
.hint{font-size:.95rem;color:#334155;}
.footer{font-size:.85rem;color:#64748b;margin-top:10px;}
</style>
</head>
<body>
<div class="board">
  <div class="panel topline">
    <h1>Crazy 8's</h1>
    <div class="badges">
      <span class="badge" id="playersBadge">Players: â€“</span>
      <span class="badge" id="deckBadge">Deck: â€“</span>
      <span class="badge" id="turnBadge">Turn: â€“</span>
    </div>
  </div>

  <div class="panel">
    <div class="row">
      <div class="controls">
        <label>Bots:
          <select id="botCount">
            <option value="1">1</option>
            <option value="2" selected>2</option>
            <option value="3">3</option>
          </select>
        </label>
        <button id="newGame">New Game</button>
        <button id="drawBtn" class="secondary">Draw</button>
      </div>
      <div class="wide discard">
        <div class="pile">
          <div><b>Top:</b> <span id="topCard" class="card small">â€“</span></div>
          <div class="subtle">Active suit: <span id="activeSuit">None</span></div>
        </div>
        <div class="subtle"> | Bot hands: <span id="botCounts">â€“</span></div>
      </div>
    </div>
  </div>

  <div class="panel">
    <div><b>Your hand</b></div>
    <div id="hand" class="hand"></div>
    <div class="hint" id="hint">Start a new game to play.</div>
  </div>

  <div class="panel">
    <div><b>Game log</b></div>
    <div id="log" class="log" aria-live="polite"></div>
    <div class="footer">Rules: match rank or suit. 8s are wildâ€”choose a suit. If you can't play, draw one. If playable, lay it; if not, turn passes.</div>
  </div>
</div>

<!-- Suit modal: replaced with SVG icons, data-suit set to suit characters -->
<div class="modal" id="suitModal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="sheet">
    <div style="font-weight:700;margin-bottom:6px">Pick a suit</div>
    <div class="suit-grid">
      <!-- Spade -->
      <button class="suit-btn" data-suit="â™ " aria-label="Spades">
        <svg viewBox="0 0 64 64" aria-hidden="true">
          <!-- Deck-style spade -->
          <path d="M32 6 C18 22, 12 34, 32 50 C52 34, 46 22, 32 6 Z" fill="black"/>
          <rect x="28" y="44" width="8" height="14" fill="black"/>
        </svg>
      </button>
      <!-- Heart -->
      <button class="suit-btn" data-suit="â™¥" aria-label="Hearts">
        <svg viewBox="0 0 64 64" aria-hidden="true">
          <path d="M32 54 C12 36, 8 18, 24 14 C30 12, 32 16, 32 20 C32 16, 34 12, 40 14 C56 18, 52 36, 32 54 Z" fill="red"/>
        </svg>
      </button>
      <!-- Diamond -->
      <button class="suit-btn" data-suit="â™¦" aria-label="Diamonds">
        <svg viewBox="0 0 64 64" aria-hidden="true">
          <polygon points="32,6 56,32 32,58 8,32" fill="red"/>
        </svg>
      </button>
      <!-- Club -->
      <button class="suit-btn" data-suit="â™£" aria-label="Clubs">
        <svg viewBox="0 0 64 64" aria-hidden="true">
          <!-- tightened circles so no hole -->
          <circle cx="32" cy="16" r="11" fill="black"/>
          <circle cx="20" cy="36" r="11" fill="black"/>
          <circle cx="44" cy="36" r="11" fill="black"/>
          <rect x="29" y="36" width="6" height="18" fill="black"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<script>
// ===== Original game logic with only bot-turn + modal fixes =====
const SUITS=['â™ ','â™¥','â™¦','â™£'];
const RANKS=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
const state={deck:[],discard:[],hands:{},players:[],activeSuit:null,turnIdx:0,bots:2,winner:null,awaitingSuit:false,playerCanMove:true};

function log(msg){const el=document.getElementById('log');el.innerHTML+=msg+"\n";el.scrollTop=el.scrollHeight;}
function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}return arr;}
function mkDeck(){const d=[];for(const s of SUITS){for(const r of RANKS){d.push({rank:r,suit:s});}}return shuffle(d);}
function cardStr(c){return c?c.rank+c.suit:'â€”';}
function isEight(c){return c.rank==='8';}
function topCard(){return state.discard[state.discard.length-1];}
function matches(c,top,activeSuit){
  if(!c||!top)return false;
  if(activeSuit) return c.suit===activeSuit || isEight(c);
  return c.rank===top.rank || c.suit===top.suit || isEight(c);
}
function reshuffleIfNeeded(){
  if(state.deck.length===0 && state.discard.length>1){
    const top = state.discard.pop();
    state.deck = shuffle(state.discard);
    state.discard = [top];
    log("[Deck reshuffled]");
    updateBadges();
  }
}
function drawCard(player){
  reshuffleIfNeeded();
  const c = state.deck.pop();
  state.hands[player].push(c);
  updateBadges();
  return c;
}
function playable(hand){return hand.filter(c=>matches(c, topCard(), state.activeSuit));}
function updateBadges(){
  document.getElementById('deckBadge').textContent='Deck: '+state.deck.length;
  document.getElementById('playersBadge').textContent='Players: '+state.players.join(', ');
  document.getElementById('botCounts').textContent=state.players.slice(1).map(p=>state.hands[p].length).join(', ');
  document.getElementById('turnBadge').textContent='Turn: '+state.players[state.turnIdx];
}

function render(){
  const handDiv=document.getElementById('hand'); handDiv.innerHTML='';
  for(const c of state.hands['You']){
    const btn=document.createElement('button'); const cardEl=document.createElement('div');
    cardEl.className='card '+((c.suit==='â™¥'||c.suit==='â™¦')?'red':'black'); cardEl.textContent=c.rank+c.suit;
    btn.appendChild(cardEl); btn.addEventListener('click',()=>playCard(c)); handDiv.appendChild(btn);
  }
  document.getElementById('topCard').textContent=cardStr(topCard());
  document.getElementById('activeSuit').textContent=state.activeSuit||topCard().suit;
  document.getElementById('hint').textContent=state.hands['You'].length?'':'Start a new game to play.';
  updateBadges();
}

function playCard(c){
  if(!state.playerCanMove || !matches(c, topCard(), state.activeSuit)) return;
  state.playerCanMove=false;
  const idx = state.hands['You'].indexOf(c); if(idx >= 0) state.hands['You'].splice(idx,1);
  state.discard.push(c); log(`You play ${cardStr(c)}`);
  if(isEight(c)){
    state.awaitingSuit=true;
    document.getElementById('suitModal').style.display='flex';
    render();
  } else {
    state.activeSuit=null;
    if(state.hands['You'].length===0){state.winner='You'; log('ðŸŽ‰ You win!'); render(); return;}
    setTimeout(nextTurn,200);
  }
  render();
}

function chooseSuit(s){
  state.activeSuit=s;
  state.awaitingSuit=false;
  document.getElementById('suitModal').style.display='none';
  setTimeout(nextTurn,200);
}
// wire up suit buttons (they have data-suit attributes)
document.querySelectorAll('.suit-btn').forEach(b => b.addEventListener('click', () => chooseSuit(b.dataset.suit)) );

async function nextTurn(){
  if(state.winner) return;
  state.turnIdx=(state.turnIdx+1)%state.players.length;
  state.playerCanMove=state.players[state.turnIdx]==='You';
  updateBadges(); render();
  if(!state.playerCanMove) await botTurn();
}

async function botTurn(){
  const bot = state.players[state.turnIdx];
  let hand = state.hands[bot];
  await new Promise(r=>setTimeout(r,400));

  // 1) Check playable cards in hand first
  let playables = playable(hand);
  if(playables.length > 0){
    const c = playables[0];
    hand.splice(hand.indexOf(c),1);
    state.discard.push(c);
    log(`${bot} plays ${cardStr(c)}`);
    if(isEight(c)){
      // bot picks a suit at random
      state.activeSuit = SUITS[Math.floor(Math.random()*4)];
      log(`${bot} chooses suit ${state.activeSuit}`);
    } else {
      state.activeSuit = null;
    }
    if(hand.length===0){ state.winner = bot; log(`ðŸŽ‰ ${bot} wins!`); render(); return; }
    render();
    await new Promise(r=>setTimeout(r,400));
    nextTurn();
    return;
  }

  // 2) No playable card: draw exactly ONE card
  const drawn = drawCard(bot);
  log(`${bot} draws ${cardStr(drawn)}`);
  await new Promise(r=>setTimeout(r,300));

  if(matches(drawn, topCard(), state.activeSuit)){
    // bot can play the drawn card immediately
    // remove from hand and place on discard
    const idx = state.hands[bot].indexOf(drawn);
    if(idx >= 0) state.hands[bot].splice(idx,1);
    state.discard.push(drawn);
    log(`${bot} plays ${cardStr(drawn)}`);
    if(isEight(drawn)){
      state.activeSuit = SUITS[Math.floor(Math.random()*4)];
      log(`${bot} chooses suit ${state.activeSuit}`);
    } else {
      state.activeSuit = null;
    }
    if(state.hands[bot].length===0){ state.winner = bot; log(`ðŸŽ‰ ${bot} wins!`); render(); return; }
    render();
    await new Promise(r=>setTimeout(r,400));
    nextTurn();
    return;
  } else {
    // cannot play drawn card -> turn passes
    render();
    await new Promise(r=>setTimeout(r,300));
    nextTurn();
    return;
  }
}

function newGame(){
  state.deck=mkDeck(); state.discard=[]; state.hands={}; state.players=['You']; state.winner=null; state.activeSuit=null;
  state.turnIdx=0; state.awaitingSuit=false; state.playerCanMove=true; state.bots=parseInt(document.getElementById('botCount').value);
  for(let i=1;i<=state.bots;i++) state.players.push('Bot '+i);
  for(const p of state.players) state.hands[p]=[];
  for(const p of state.players) for(let j=0;j<5;j++) drawCard(p);
  state.discard.push(state.deck.pop());
  render();
}

document.getElementById('newGame').addEventListener('click',newGame);
document.getElementById('drawBtn').addEventListener('click',()=>{
  if(!state.playerCanMove||state.awaitingSuit) return;

  // New rule: player may draw ONLY ONE card; if playable, must play; else turn passes.
  const newCard = drawCard('You');
  log(`You draw ${cardStr(newCard)}`);
  if(matches(newCard, topCard(), state.activeSuit)){
    log(`You can play ${cardStr(newCard)} immediately`);
    // play the drawn card
    const idx = state.hands['You'].indexOf(newCard);
    if(idx >= 0) state.hands['You'].splice(idx,1);
    state.discard.push(newCard);
    if(isEight(newCard)){
      state.awaitingSuit=true;
      document.getElementById('suitModal').style.display='flex';
      render();
      return;
    } else {
      state.activeSuit=null;
      if(state.hands['You'].length===0){state.winner='You'; log('ðŸŽ‰ You win!'); render(); return;}
      setTimeout(nextTurn,200);
    }
  } else {
    log(`You cannot play ${cardStr(newCard)}. Turn passes.`);
    state.playerCanMove=false;
    setTimeout(nextTurn,400);
  }
  render();
});
</script>
</body>
</html>
