<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Crazy Eights – Fully Working</title>
<style>
:root{--gap:10px;--card-pad:10px;--btn-pad:12px 16px;--radius:10px;--shadow:0 2px 8px rgba(0,0,0,.15);}
*{box-sizing:border-box;}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;padding:16px;background:#f6f7fb;color:#111;}
h1{font-size:1.4rem;margin:0 0 8px;}
.row{display:flex;gap:var(--gap);flex-wrap:wrap;align-items:center;}
.board{display:flex;flex-direction:column;gap:var(--gap);max-width:900px;margin:0 auto;}
.panel{background:#fff;border-radius:var(--radius);padding:12px;box-shadow:var(--shadow);}
.topline{display:flex;align-items:center;justify-content:space-between;gap:12px;}
.badges{display:flex;gap:8px;flex-wrap:wrap;}
.badge{background:#eef;border-radius:999px;padding:6px 10px;font-size:.9rem;}
.controls{display:flex;gap:8px;flex-wrap:wrap;}
button{padding:var(--btn-pad);border-radius:12px;border:0;background:#111;color:#fff;font-weight:600;box-shadow:var(--shadow);touch-action:manipulation;}
button.secondary{background:#e5e7eb;color:#111;}
button:disabled{opacity:.55;}
.card{display:inline-flex;align-items:center;justify-content:center;padding:var(--card-pad);min-width:52px;height:72px;border-radius:8px;border:2px solid #ddd;background:#fff;font-weight:700;box-shadow:var(--shadow);margin:4px;user-select:none;}
.card.red{color:#c0262d;}
.card.black{color:#111;}
.card.small{min-width:44px;height:60px;font-size:.95rem;}
.hand{display:flex;flex-wrap:wrap;}
.hand button{background:transparent;border:none;padding:0;margin:0;}
.subtle{color:#555;font-size:.95rem;}
.discard{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
.pile{display:flex;align-items:center;gap:8px;}
.wide{width:100%;}
.log{max-height:160px;overflow:auto;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:.95rem;background:#0b1020;color:#e6edf3;border-radius:10px;padding:10px;}
.log b{color:#ffcf55;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:16px;z-index:10;}
.modal .sheet{background:#fff;border-radius:16px;max-width:420px;width:100%;padding:18px;box-shadow:var(--shadow);text-align:center;}
.suit-grid{display:grid;grid-template-columns:repeat(2,minmax(120px,1fr));gap:12px;margin-top:10px;}
.suit-btn{font-size:1.4rem;padding:18px;border-radius:12px;border:2px solid #ddd;background:#fff;box-shadow:var(--shadow);}
.hint{font-size:.95rem;color:#334155;}
.footer{font-size:.85rem;color:#64748b;margin-top:10px;}
</style>
</head>
<body>
<div class="board">
  <div class="panel topline">
    <h1>Crazy Eights – Fully Working</h1>
    <div class="badges">
      <span class="badge" id="playersBadge">Players: –</span>
      <span class="badge" id="deckBadge">Deck: –</span>
      <span class="badge" id="turnBadge">Turn: –</span>
    </div>
  </div>

  <div class="panel">
    <div class="row">
      <div class="controls">
        <label>Bots:
          <select id="botCount">
            <option value="1">1</option>
            <option value="2" selected>2</option>
            <option value="3">3</option>
          </select>
        </label>
        <button id="newGame">New Game</button>
        <button id="drawBtn" class="secondary">Draw</button>
      </div>
      <div class="wide discard">
        <div class="pile">
          <div><b>Top:</b> <span id="topCard" class="card small">–</span></div>
          <div class="subtle">Active suit: <span id="activeSuit">None</span></div>
        </div>
        <div class="subtle"> | Bot hands: <span id="botCounts">–</span></div>
      </div>
    </div>
  </div>

  <div class="panel">
    <div><b>Your hand</b></div>
    <div id="hand" class="hand"></div>
    <div class="hint" id="hint">Start a new game to play.</div>
  </div>

  <div class="panel">
    <div><b>Game log</b></div>
    <div id="log" class="log" aria-live="polite"></div>
    <div class="footer">Rules: match rank or suit. 8s are wild—choose a suit. If you can't play, draw until you can.</div>
  </div>
</div>

<div class="modal" id="suitModal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="sheet">
    <div style="font-weight:700;margin-bottom:6px">Pick a suit</div>
    <div class="suit-grid">
      <button class="suit-btn" data-suit="♠">♠ Spades</button>
      <button class="suit-btn" data-suit="♥">♥ Hearts</button>
      <button class="suit-btn" data-suit="♦">♦ Diamonds</button>
      <button class="suit-btn" data-suit="♣">♣ Clubs</button>
    </div>
  </div>
</div>

<script>
// --- GAME LOGIC ---
const SUITS = ['♠','♥','♦','♣'];
const RANKS = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
const state = { deck: [], discard: [], hands: {}, players: [], activeSuit: null, turnIdx: 0, bots: 2, winner: null };

function log(msg){ const el = document.getElementById('log'); el.innerHTML += msg + "\n"; el.scrollTop = el.scrollHeight; }
function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }
function mkDeck(){ const d=[]; for(const s of SUITS){ for(const r of RANKS){ d.push({rank:r,suit:s}); } } return shuffle(d); }
function cardStr(c){ return c ? c.rank+c.suit : '—'; }
function isEight(c){ return c.rank==='8'; }
function topCard(){ return state.discard[state.discard.length-1]; }
function matches(c,top,activeSuit){ 
  if(!c||!top) return false; 
  if(activeSuit) return c.suit===activeSuit || isEight(c);
  return c.rank===top.rank || c.suit===top.suit || isEight(c);
}
function reshuffleIfNeeded(){ 
  if(state.deck.length===0){ 
    if(state.discard.length>1){ 
      const top=state.discard.pop(); 
      state.deck=shuffle(state.discard); 
      state.discard=[top]; 
      log("[Deck reshuffled]"); updateBadges(); 
    } 
  } 
}

// --- HELPER FUNCTIONS ---
function drawCard(player){
  reshuffleIfNeeded();
  const c = state.deck.pop();
  state.hands[player].push(c);
  updateBadges();
  return c;
}
function playable(hand){ return hand.filter(c=>matches(c,topCard(),state.activeSuit)); }
function updateBadges(){
  document.getElementById('deckBadge').textContent = 'Deck: '+state.deck.length;
  document.getElementById('playersBadge').textContent = 'Players: '+state.players.join(', ');
  document.getElementById('botCounts').textContent = state.players.slice(1).map(p=>state.hands[p].length).join(', ');
  document.getElementById('turnBadge').textContent = 'Turn: '+state.players[state.turnIdx];
}
function render(){
  const handDiv=document.getElementById('hand');
  handDiv.innerHTML='';
  for(const c of state.hands['You']){
    const btn=document.createElement('button');
    const cardEl=document.createElement('div');
    cardEl.className='card '+((c.suit==='♥'||c.suit==='♦')?'red':'black');
    cardEl.textContent=c.rank+c.suit;
    btn.appendChild(cardEl);
    btn.addEventListener('click',()=>playCard(c));
    handDiv.appendChild(btn);
  }
  document.getElementById('topCard').textContent = cardStr(topCard());
  document.getElementById('activeSuit').textContent = state.activeSuit||topCard().suit;
  updateBadges();
}
function playCard(c){
  if(!matches(c,topCard(),state.activeSuit)) return;
  const idx=state.hands['You'].indexOf(c);
  if(idx>=0) state.hands['You'].splice(idx,1);
  state.discard.push(c);
  if(isEight(c)){
    document.getElementById('suitModal').style.display='flex';
    state.awaitingSuit=true;
  } else {
    state.activeSuit=null;
    nextTurn();
  }
  render();
}
function chooseSuit(s){
  state.activeSuit=s;
  state.awaitingSuit=false;
  document.getElementById('suitModal').style.display='none';
  nextTurn();
}
document.querySelectorAll('.suit-btn').forEach(b=>b.addEventListener('click',()=>chooseSuit(b.dataset.suit)));
function nextTurn(){
  if(state.hands['You'].length===0){ log("You win!"); return; }
  state.turnIdx=(state.turnIdx+1)%state.players.length;
  if(state.turnIdx>0) setTimeout(botPlay,500);
}
function botPlay(){
  const bot=state.players[state.turnIdx];
  const options=playable(state.hands[bot]);
  if(options.length>0){
    const c=options[Math.floor(Math.random()*options.length)];
    state.hands[bot].splice(state.hands[bot].indexOf(c),1);
    state.discard.push(c);
    log(bot+' plays '+c.rank+c.suit+(isEight(c)?' (8 wild)':''));
    if(isEight(c)) state.activeSuit=SUITS[Math.floor(Math.random()*4)];
    else state.activeSuit=null;
    render();
  } else {
    const drawn=drawCard(bot);
    log(bot+' draws a card');
    const playableNow=playable(state.hands[bot]);
    if(playableNow.length>0) botPlay(); else nextTurn();
  }
  if(state.hands[bot].length===0){ log(bot+' wins!'); return; }
  if(state.turnIdx>0 && state.turnIdx<state.players.length-1) setTimeout(botPlay,500);
  else if(state.turnIdx===0) updateBadges();
}

// --- NEW GAME ---
function newGame(){
  state.bots=parseInt(document.getElementById('botCount').value);
  state.deck=mkDeck();
  state.discard=[];
  state.hands={};
  state.players=['You'];
  for(let i=0;i<state.bots;i++) state.players.push('Bot '+(i+1));
  state.turnIdx=0;
  state.activeSuit=null;
  state.winner=null;
  state.awaitingSuit=false;

  for(const p of state.players){ state.hands[p]=[]; for(let j=0;j<5;j++) drawCard(p); }

  let first;
  do{ first=state.deck.pop(); } while(first.rank==='8');
  state.discard.push(first);
  state.activeSuit=null;
  log("\n--- New Game Started ---");
  render();
}

// --- EVENT LISTENERS ---
document.getElementById('newGame').addEventListener('click',newGame);
document.getElementById('drawBtn').addEventListener('click',()=>{
  if(state.awaitingSuit) return;
  drawCard('You');
  render();
});

</script>
</body>
</html>
